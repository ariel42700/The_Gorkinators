---
title: "Presentation Visualizations"
author: "Dylan Jacobs, Jun Pu, and Ariel Lutati"
date: "2024-03-07"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Import packages
```{r message=FALSE, warning=FALSE}
library(gapminder)
library(ggplot2)
library(plotly)
library(dplyr)
library(readxl)
library(leaflet)
library(sf)
library(RColorBrewer)
library(shiny)
```

# Data Cleaning

```{r}
#selected_columns <- c("Country name", "Year", "Adult population", "Region", "Income group", "Saved at a financial institution (% age 15+)")
df <- read_excel("DatabankWide.xlsx")
# View(df)
```

# Select the variabels of interest
```{r}
df_var <- df[c("Country name", "Year", "Region", "Adult populaiton", "Income group", "Made or received a digital payment (% age 15+)", "Financial institution account (% age 15+)")]
```

# Rename variables to make it look nicer
```{r}
# Create a new dataframe df_rename
df_rename <- df_var

# Rename "Made or received a digital payment (% age 15+)" to "payment_digital"
colnames(df_rename)[colnames(df_rename) == "Made or received a digital payment (% age 15+)"] <- "payment_digital"

# Rename "Financial institution account (% age 15+)" to "account_fin"
colnames(df_rename)[colnames(df_rename) == "Financial institution account (% age 15+)"] <- "account_fin"

# Rename "Country name" to "country"
colnames(df_rename)[colnames(df_rename) == "Country name"] <- "country"

# Rename "Adult populaiton" to "population"
colnames(df_rename)[colnames(df_rename) == "Adult populaiton"] <- "population"

# Rename "Income group" to "group_income"
colnames(df_rename)[colnames(df_rename) == "Income group"] <- "group_income"

# Rename "Year" to "year"
colnames(df_rename)[colnames(df_rename) == "Year"] <- "year"

# Rename "Region" to "region"
colnames(df_rename)[colnames(df_rename) == "Region"] <- "region"

# Remove N/A values
df_rename <- na.omit(df_rename)

```

```{r}
# Check variable type
str(df_rename)
```

# Create an interactive scatter plot
```{r}
plot <- df_rename %>%
  plot_ly(x = ~account_fin, y = ~payment_digital, 
          color = ~group_income, text = ~paste(country, "<br>", year),
          mode = "markers", marker = list(sizemode = "diameter", opacity = 0.6)) %>%
  layout(title = "Financial Account vs. Savings at Financial Institution",
         xaxis = list(title = "Percentage with an account at a Financial Institution"),
         yaxis = list(title = "Percentage made or received a digital payment"),
         showlegend = TRUE)

# Show the plot
plot

```

```{r}
# Create an interactive scatter plot with a slider for 'year'
# Define the UI
ui <- fluidPage(
  sliderInput("year_slider", "Select Year", min = min(df_rename$year), max = max(df_rename$year), value = min(df_rename$year), step = 1),
  plotlyOutput("scatter_plot")
)

# Define the server
server <- function(input, output) {
  filtered_data <- reactive({
    df_rename[df_rename$year == input$year_slider, ]
  })

  output$scatter_plot <- renderPlotly({
    plot_ly(data = filtered_data(),
            x = ~account_fin, y = ~payment_digital,
            color = ~group_income, text = ~paste(country, "<br>", year),
            mode = "markers", marker = list(sizemode = "diameter", opacity = 0.6)) %>%
      layout(title = "Financial Account vs. Savings at Financial Institution",
             xaxis = list(title = "Percentage with an account at a Financial Institution"),
             yaxis = list(title = "Percentage made or received a digital payment"),
             showlegend = TRUE)
  })
}

# Run the Shiny app
shinyApp(ui, server)

```



